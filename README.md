# üîó –°–µ—Ä–≤–∏—Å –ø–æ —Å–æ–∫—Ä–∞—â–µ–Ω–∏—é URL —Å—Å—ã–ª–æ–∫

–î–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∫–æ—Ä–æ—Ç–∫—É—é URL —Å—Å—ã–ª–∫—É

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É Short-url
```bash
git clone https://github.com/IvanMakhrov/Short-url.git
cd short-links
```

2. –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```bash
docker-compose up -d --build
```

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| Postgres | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –∏ —Å—Å—ã–ª–∫–∞—Ö <br> **URL:** jdbc:postgresql://localhost:5432/shortlinks <br> **Username:** postgres <br> **Password:** postgres |
| FastAPI | API —Å–µ—Ä–≤–∏—Å <br> –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://0.0.0.0:8000/docs |
| Redis | –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ |

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ links
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| link_id | PRIMARY KEY | ID —Å—Å—ã–ª–∫–∏ |
| original_url | VARCHAR | –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL |
| short_code | VARCHAR | –°–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–π –∫–æ–¥ —Å—Å—ã–ª–∫–∏ |
| created_at | TIMESTAMP | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è |
| expires_at | TIMESTAMP | –î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è |
| user_id | FOREIGN KEY | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| click_count | INTEGER | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ |
| last_accessed | TIMESTAMP | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞ |

### –¢–∞–±–ª–∏—Ü–∞ users
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | PRIMARY KEY | ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| email | VARCHAR | Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| hashed_password | VARCHAR | –•–µ—à –ø–∞—Ä–æ–ª—è |
| registered_at | TIMESTAMP | –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ |
| is_active | BOOLEAN | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –∞–∫–∫–∞—É–Ω—Ç (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) |
| is_superuser | BOOLEAN | –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) |
| is_verified | BOOLEAN | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –ª–∏ –∞–∫–∫–∞—É–Ω—Ç (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) |

### –¢–∞–±–ª–∏—Ü–∞ alembic_version
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| version_num | PRIMARY KEY | ID –º–∏–≥—Ä–∞—Ü–∏–∏ |

---

## üåê –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–æ—É—Ç–µ—Ä—ã

### üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

#### 1. POST http://localhost:8000/auth/register
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è<br>
–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:<br>
```json
{
  "email": "string",
  "password": "string",
  "is_active": true,
  "is_superuser": false,
  "is_verified": false
}
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:<br>
```json
{
  "id": 2,
  "email": "string1",
  "is_active": true,
  "is_superuser": false,
  "is_verified": false
}
```

#### 2. POST http://localhost:8000/auth/jwt/login
–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è<br>
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- username (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- password (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:<br>
```json
{
  "access_token": "token",
  "token_type": "bearer"
}
```

#### 3. POST http://localhost:8000/auth/jwt/logout
–í—ã—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è<br>
–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:<br>
```
http://localhost:8000/auth/jwt/logout
```

### üîó –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å URL

#### 1. POST /links/shorten<br>
–î–æ—Å—Ç—É–ø: –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º<br>
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- original_url (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- custom_alias (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- expires_at (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:<br>
```json 
{"original_url": "https://example.com/",  "custom_alias": "custom_link"} 
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:<br>
```json 
{"short_code": "http://localhost:8000/links/my-link"} 
```

#### 2. GET /links/{short_code}
–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ url –∞–¥—Ä–µ—Å –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ<br>
–î–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º<br>

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:<br>
```
GET http://localhost:8000/links/custom_link
```
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ https://example.com/

#### 3. DELETE /links/{short_code}
–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏ –∏–∑ –ë–î<br>
–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º. –ú–æ–∂–Ω–æ —É–¥–∞–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å—Å—ã–ª–∫–∏<br>

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:<br>
```
DETELE http://localhost:8000/links/custom_link
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:<br>
```json
{"message": "Link deleted"}
```

#### 4. PUT /links/{short_code}
–ò–∑–º–µ–Ω–µ–Ω–∏–µ url –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ<br>
–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º. –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å—Å—ã–ª–∫–∏<br>

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:<br>
```
PUT http://localhost:8000/links/custom_link?new_url=https%3A%2F%2Fwww.google.com%2F
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:<br>
```json
{"message": "Link updated"}
```

#### 5. GET /links/{short_code}/stats
–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏<br>
–î–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º<br>

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:<br>
```
GET http://localhost:8000/links/custom_link/stats
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:<br>
```json
{
  "original_url": "https://example.com/",
  "created_at": "2025-03-30T12:00:00",
  "expires_at": null,
  "click_count": 1,
  "last_accessed": "2025-03-30T15:30:00"
}
```

#### 6. GET /links/search/{original_url}
–ù–∞–π—Ç–∏ –∫–æ—Ä–æ—Ç–∫—É—é —Å—Å—ã–ª–∫—É –ø–æ url –∞–¥—Ä–µ—Å—É –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É<br>
–î–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º<br>

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:<br>
```
GET http://localhost:8000/links/search/custom_link
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:<br>
```json
{
    "short_code": "custom_link",
    "created_at": "2025-03-30T12:00:00",
    "expires_at": null,
    "click_count": 1,
    "last_accessed": "2025-03-30T15:30:00"
  }
  ```

#### 7.PATCH /links{short_link}/expiration
–û–±–Ω–æ–≤–∏—Ç—å –¥–∞—Ç—É –∫–æ–≥–¥–∞ —Å—Å—ã–ª–∫–∞ —Å—Ç–∞–Ω–µ—Ç –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ä–æ—É—Ç–µ—Ä)<br>
–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º. –ú–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ —Å—Å—ã–ª–∫–∏<br>

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:<br>
```
PATCH http://localhost:8000/links/82cc5b/expiration?expires_at=2025-03-31T15%3A30%3A00
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:<br>
```json
{
  "message": "Expiration updated",
  "expires_at": "2025-03-30T15:30:00"
}
```

### üîß –¢–µ—Å—Ç–æ–≤—ã–µ —Ä–æ—É—Ç–µ—Ä—ã
#### 1. GET /protected-route
–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º<br>

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:<br>
```
GET http://localhost:8000/protected-route
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:<br>
```json
{"detail": "Unauthorized"}
```

#### 2. GET /unprotected-route
–î–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º<br>

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:<br>
```
GET http://localhost:8000/unprotected-route
```
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:<br>
```
"Hello, anonym"
```

## ‚öôÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- üóëÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç–µ–∫—à–∏—Ö —Å—Å—ã–ª–æ–∫ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)
- üïí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å—Å—ã–ª–æ–∫ (–±–æ–ª–µ–µ 7 –¥–Ω–µ–π –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## üìä –¢–µ—Å—Ç—ã –∏ –¥–µ–ø–ª–æ–π
–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤<br>
```bash
pytest --cov=src --cov-report=html tests/ 
```

–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏<br>
```bash
python3 -m coverage report 
```

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ —Ç–µ—Å—Ç–∞–º–∏<br>
```bash
open index.html
```

–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –¥–µ–ø–ª–æ—è —Å–µ—Ä–≤–∏—Å–∞ –∏ —Ç–µ—Å—Ç–æ–≤

### –î–µ–ø–ª–æ–π —Å–µ—Ä–≤–∏—Å–∞
![Alt text](https://github.com/IvanMakhrov/Short-url/blob/main/images/docker.png?raw=true)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
![Alt text](https://github.com/IvanMakhrov/Short-url/blob/main/images/tests_success.png?raw=true)

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
![Alt text](https://github.com/IvanMakhrov/Short-url/blob/main/images/tests_coverage.png?raw=true)

### –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
![Alt text](https://github.com/IvanMakhrov/Short-url/blob/main/images/locust_tests.png?raw=true)
